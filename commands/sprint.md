# Открытие спринта

Выполни последовательность открытия нового спринта — фаза 1 (Планирование, GATE 1).
Каждый шаг обязателен. Без подтверждения владельца дальше не двигайся.

## Шаг 0: Проверка предусловий

Прочитай файл целей проекта (GOALS.md или аналог, ищи путь в CLAUDE.md) и проверь:

1. **Нет активной цели** — секция текущей цели должна быть пустой / содержать "Нет активной цели".
   Если есть активная цель — СТОП. Покажи:
   ```
   Активна цель: G-XXX — [название]

   Варианты:
   A) Закрыть текущую цель сначала (/close)
   B) Отменить текущую цель и начать новую (требует подтверждения)
   ```
   Жди решения владельца.

2. **Есть цели в очереди** — очередь целей не пуста.
   Если очередь пуста — СТОП. Покажи:
   ```
   Очередь целей пуста.

   Варианты:
   A) Запустить /plan для наполнения очереди целей
   B) Сформулировать одну цель прямо сейчас (быстрый старт — перейди к Шагу 2, вариант В)
   ```
   Жди решения владельца.

## Шаг 1: Выбор цели

Определи следующую цель из очереди (первая незавершённая по порядку).

Проверь зависимости:
- Прочитай поле "Зависит от" у выбранной цели
- Убедись что все зависимости отмечены как завершённые
- Если зависимость НЕ завершена — покажи варианты:
  ```
  Цель G-XXX зависит от G-YYY, которая ещё не завершена.

  Варианты:
  A) Сначала завершить G-YYY
  B) Взять другую цель из очереди (без незавершённых зависимостей)
  C) Игнорировать зависимость (владелец подтверждает риски)
  ```
  Жди решения владельца.

Покажи владельцу выбранную цель:

```
Следующая цель из очереди: G-XXX — [название]

Критерий успеха:
- [критерий 1]
- [критерий 2]

Зависимости: [все завершены / список]
Связанные фичи в backlog: [F-NNN, F-NNN, ...]

Варианты:
A) Взять эту цель
B) Выбрать другую цель из очереди
C) Сформулировать новую цель (не из очереди)
```

**Жди явный выбор владельца.**

## Шаг 2: Совместное планирование (GATE 1)

В зависимости от выбора владельца:

**Вариант А/Б — цель из очереди:**

1. Покажи существующие критерии успеха и спроси:
   - "Критерии актуальны? Нужно уточнить/добавить/убрать?"

2. Покажи связанные фичи из бэклога и спроси:
   - "Какие фичи включаем в этот спринт? Всё или часть?"
   - "Нужны ли новые фичи, которых нет в бэклоге?"

3. Предложи декомпозицию на задачи и спроси:
   - "Согласуем разбивку? Что добавить/убрать/изменить?"

**Вариант В — новая цель:**

1. Спроси у владельца:
   - "Как называется цель? (G-XXX: [название])"
   - "Какой критерий успеха? (что значит 'цель достигнута')"
   - "Какие фичи нужны?"
   - "Есть ли зависимости от других целей?"

2. Предложи декомпозицию и согласуй.

**Для обоих вариантов — согласуй итоговый план:**

```
Декомпозиция G-XXX

Критерий успеха:
- [ ] [критерий 1]
- [ ] [критерий 2]

Задачи:
- [ ] [задача 1] — [краткое описание]
- [ ] [задача 2] — [краткое описание]
- [ ] [задача 3] — [краткое описание]

Фичи из backlog: F-NNN, F-NNN
Нужен ли ревью плана @auditor: [да/нет — рекомендуется при > 3 файлов или архитектурных изменениях]
```

**Жди явное "ОК" или корректировки от владельца.**
Без подтверждения декомпозиции дальше не двигайся — это GATE 1.

## Шаг 3: Настройка спринта

После получения "ОК" от владельца:

1. **Обнови файл целей** — секция текущей цели:
   - Замени "Нет активной цели..." на согласованную декомпозицию
   - Обнови метрику "В работе"
   - **Лимит: секция текущей цели < 100 строк.**
     Цель — "прочитал один раз, понял где мы". Если контекст растёт —
     выноси детали в файл заметок, в целях оставляй только декомпозицию и статус.

2. **Создай файл заметок** для цели (по шаблону, если есть в проекте):
   - Установи статус: in-progress
   - Установи начало: текущая дата
   - Заполни контекст из обсуждения с владельцем
   - Если файл уже существует — спроси: перезаписать или дополнить?
   - **Здесь можно писать подробно** — решения, контекст, подходы.
     Файл заметок — это расширенная память, файл целей — дайджест.

3. **Обнови бэклог** (если нужно):
   - Детализируй фичи для текущей цели
   - Добавь новые фичи (если были согласованы)

## Шаг 4: Ревью плана @auditor (опционально)

Если владелец согласился на ревью (рекомендуется при > 3 файлов, архитектурных изменениях, security-related):

Запусти @auditor:
```
@auditor Проверь план реализации:
- Цель: G-XXX
- Декомпозиция: [список задач]
- Файлы: [список файлов для изменения]

Режим: ревью плана (до начала разработки)
Проверить: архитектурные риски, пропущенные edge cases, security implications
```

Если аудитор нашёл проблемы — скорректируй план и вернись к Шагу 2 для повторного согласования.

## Шаг 5: Старт

Покажи владельцу финальное сообщение:

```
Начинаю работу над целью G-XXX: [название]

Критерий успеха:
- [критерий 1]
- [критерий 2]

План работы:
1. [задача 1]
2. [задача 2]
...

Обновлённые файлы:
- goals file — обновлён
- notes file — создан
- backlog — обновлён / без изменений

Есть вопросы перед стартом? Если нет — начинаю первую задачу из декомпозиции.
```

**Жди "ОК" от владельца.** После подтверждения — начинай разработку первой задачи из декомпозиции выше (фаза 2).

> **ВАЖНО**: НЕ предлагай `/task` — это скилл для board-mode. В sprint-mode разработка начинается напрямую по декомпозиции.
