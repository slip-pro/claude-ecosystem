# Session Handoff

## Проактивный snapshot (ВАЖНО)

При работе над большими задачами (5+ файлов, 3+ шагов TDD,
несколько субагентов) — **пиши snapshot прогресса** в `.claude/handoff.md`
после каждого крупного этапа, НЕ ДОЖИДАЯСЬ compaction.

Триггеры для snapshot:
- Завершён этап TDD (RED→GREEN для группы тестов)
- Создано 3+ новых файла
- Завершена работа субагента (@developer, @tester)
- Прошло 15+ tool calls с начала задачи

Формат snapshot — тот же что для compaction (см. ниже).
Файл перезаписывается каждый раз (не append).

**Зачем:** compaction срабатывает внезапно. Если snapshot
уже написан — потеря контекста минимальна. Если нет —
теряются детали (какие файлы созданы, какие решения приняты),
и при /done приходится восстанавливать картину по git diff.

## При compaction

Когда срабатывает PreCompact хук, ты получишь инструкцию написать handoff.
**Обязательно** напиши `.claude/handoff.md` с секциями:

- **Current State** — над чем работаешь, какая задача/фаза
- **Completed Work** — что сделано в этой сессии
  - Список всех созданных/изменённых файлов с кратким описанием
  - Какие тесты написаны и их статус
- **Remaining Work** — что осталось
- **Decisions Made** — ключевые решения и ПОЧЕМУ (чтобы не передебатировать)
- **Next Action** — конкретный первый шаг после восстановления

## После compaction

При восстановлении контекста — прочитай:
1. `.claude/compact-state.json` — git-статус
2. `.claude/handoff.md` — структурированный контекст сессии
3. Продолжи с **Next Action** из handoff

## При переключении задач

Если владелец просит переключиться на другую задачу —
напиши handoff для текущей задачи перед переключением.
Файл: `.claude/handoff-{task-id}.md`

## Удаление handoff

После успешного восстановления контекста — удали использованный handoff файл.
Он одноразовый, не архив.
