# ============================================================
# tmux config â€” productivity setup for dev server + mobile SSH
# ============================================================
# Install: bash setup.sh (or manually copy to ~/.tmux.conf)
# After: prefix + I to install plugins via TPM
# ============================================================

# -----------------------------------------------------------
# General settings
# -----------------------------------------------------------

# Keep Ctrl+b as prefix (standard, no muscle memory breakage)
# Uncomment below to switch to Ctrl+a if preferred:
# set -g prefix C-a
# unbind C-b
# bind C-a send-prefix

# True color support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Start windows and panes at 1 (not 0)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Mouse mode (essential for Termius / mobile)
set -g mouse on

# Longer display time for pane numbers (prefix + q)
set -g display-panes-time 2000

# Larger scrollback buffer
set -g history-limit 50000

# Reduce escape time (faster vim response)
set -sg escape-time 10

# Focus events (needed for vim autoread, etc.)
set -g focus-events on

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# -----------------------------------------------------------
# Keybindings
# -----------------------------------------------------------

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded"

# Intuitive split keys
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window keeps current path
bind c new-window -c "#{pane_current_path}"

# Vi-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resize with repeatable keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Vi-mode for copy
setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Quick session switching (fallback if sessionx not loaded)
bind S choose-tree -sZ

# -----------------------------------------------------------
# Status bar (clean minimal style)
# -----------------------------------------------------------

set -g status-position bottom
set -g status-style "bg=colour235,fg=colour250"
set -g status-left-length 30
set -g status-right-length 50
set -g status-left " #[fg=colour39,bold]#S #[fg=colour245]| "
set -g status-right "#[fg=colour245]%H:%M #[fg=colour250]%d-%b "

# Active window
setw -g window-status-current-style "fg=colour39,bold"
setw -g window-status-current-format " #I:#W "

# Inactive window
setw -g window-status-style "fg=colour245"
setw -g window-status-format " #I:#W "

# Pane borders
set -g pane-border-style "fg=colour238"
set -g pane-active-border-style "fg=colour39"

# -----------------------------------------------------------
# Plugin settings (configure BEFORE loading TPM)
# -----------------------------------------------------------

# tmux-continuum: auto-restore on tmux start
set -g @continuum-restore 'on'
# tmux-continuum: save interval (minutes)
set -g @continuum-save-interval '15'

# tmux-resurrect: restore vim/neovim sessions
set -g @resurrect-strategy-nvim 'session'

# tmux-sessionx: fuzzy session switcher
set -g @sessionx-bind 'o'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-preview-enabled 'true'

# extrakto: fuzzy text grabber
set -g @extrakto_key 'tab'
set -g @extrakto_split_direction 'p'

# -----------------------------------------------------------
# Plugins (via TPM)
# -----------------------------------------------------------

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'jaclu/tmux-menus'
set -g @plugin 'laktak/extrakto'
set -g @plugin 'omerxx/tmux-sessionx'

# Optional: catppuccin theme (uncomment to enable)
# set -g @plugin 'catppuccin/tmux'
# set -g @catppuccin_flavor 'mocha'

# -----------------------------------------------------------
# Initialize TPM (MUST be last line)
# -----------------------------------------------------------
run '~/.tmux/plugins/tpm/tpm'
