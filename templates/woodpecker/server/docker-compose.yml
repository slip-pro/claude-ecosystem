# Woodpecker CI Server + Agent
# Deploy to VPS: /opt/woodpecker/
#
# 1. Copy this file and .env.example to /opt/woodpecker/
# 2. Rename .env.example to .env, fill in values
# 3. docker compose up -d
# 4. Configure reverse proxy (see README)

services:
  woodpecker-server:
    image: woodpeckerci/woodpecker-server:v3
    ports:
      - "127.0.0.1:8000:8000"
    volumes:
      - woodpecker-data:/var/lib/woodpecker/
    env_file: .env
    environment:
      - WOODPECKER_OPEN=true
      - WOODPECKER_GITHUB=true
    restart: always

  woodpecker-agent:
    image: woodpeckerci/woodpecker-agent:v3
    command: agent
    depends_on: [woodpecker-server]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - WOODPECKER_SERVER=woodpecker-server:9000
      - WOODPECKER_AGENT_SECRET=${WOODPECKER_AGENT_SECRET}
    restart: always

volumes:
  woodpecker-data:
